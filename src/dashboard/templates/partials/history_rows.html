
{% for week_group in history|batch(5) %}
{% set week_list = week_group|list|reverse|list %}
<div class="bento-card p-6 bg-white/5 border-white/10 hover:border-indigo-500/10 transition-colors">
    <div class="flex justify-between items-center mb-6">
        <h3 class="text-xs font-bold flex items-center gap-2 uppercase tracking-widest text-gray-400">
            <i data-lucide="calendar-days" class="w-4 h-4"></i>
            Week of {{ week_list[0].date }} / <span class="text-[10px] opacity-70">주간 기록</span>
        </h3>
        <span class="text-[10px] text-gray-500 font-mono">{{ week_list[0].date }} ~ {{ week_list[-1].date }}</span>
    </div>
    
    <div class="grid grid-cols-5 gap-3">
        {% for item in week_list %}
        <div class="relative flex flex-col items-center p-4 rounded-3xl transition-all group min-h-[160px]
                    {% if item.is_correct is not none %}
                        {% if item.is_correct %}
                            bg-emerald-500/10 border border-emerald-500/30
                        {% else %}
                            bg-rose-500/10 border border-rose-500/30
                        {% endif %}
                    {% elif item.status and 'Buy' in item.status %}
                        bg-amber-500/5 border border-amber-500/30
                    {% elif item.status and 'Sell' in item.status %}
                        bg-indigo-500/5 border border-indigo-500/30
                    {% else %}
                        bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 hover:border-indigo-500/30
                    {% endif %}">
            <!-- Top Row: Date & Verify -->
            <div class="flex justify-between items-start w-full mb-3">
                <div class="flex flex-col leading-tight">
                    <span class="text-[9px] font-bold uppercase text-gray-500">{{ item.day_en }}</span>
                    <span class="text-xs font-bold text-gray-300">{{ item.date[5:] }}</span>
                </div>
                {% if item.is_correct is not none %}
                    {% if item.is_correct %}
                        <div class="w-5 h-5 rounded-full bg-emerald-500/10 flex items-center justify-center border border-emerald-500/20">
                            <i data-lucide="check" class="w-3 h-3 text-emerald-500"></i>
                        </div>
                    {% else %}
                        <div class="w-5 h-5 rounded-full bg-rose-500/10 flex items-center justify-center border border-rose-500/20">
                            <i data-lucide="x" class="w-3 h-3 text-rose-500"></i>
                        </div>
                    {% endif %}
                {% endif %}
            </div>

            <!-- Icon -->
            <div class="mb-3">
                {% if item.status and 'Buy' in item.status %}
                    <div class="p-2 rounded-full bg-amber-500/10 shadow-[0_0_15px_rgba(245,158,11,0.2)]">
                        <i data-lucide="sun" class="w-6 h-6 text-amber-500"></i>
                    </div>
                {% elif item.status and 'Sell' in item.status %}
                    <div class="p-2 rounded-full bg-indigo-500/10 shadow-[0_0_15px_rgba(99,102,241,0.2)]">
                        <i data-lucide="cloud-lightning" class="w-6 h-6 text-indigo-500"></i>
                    </div>
                {% else %}
                    <div class="p-2 rounded-full bg-gray-500/10">
                        <i data-lucide="minus" class="w-6 h-6 text-gray-400"></i>
                    </div>
                {% endif %}
            </div>

            <!-- Status & Return -->
            <div class="text-center w-full">
                <div class="text-[10px] font-black uppercase tracking-wider text-gray-400 mb-1 truncate px-2">
                    {{ item.status }}
                </div>
                
                {% if item.actual_return is not none %}
                    <div class="inline-block px-2 py-0.5 rounded text-[10px] font-mono font-bold 
                                {{ 'bg-emerald-500/10 text-emerald-400' if item.actual_return > 0 else 'bg-rose-500/10 text-rose-400' }}">
                        {{ "%+.2f"|format(item.actual_return) }}%
                    </div>
                {% else %}
                     {% if item.status == 'HOLIDAY' %}
                         <div class="text-[10px] text-gray-700 font-mono italic">CLOSED</div>
                     {% elif item.status == 'NEUTRAL' %}
                         <div class="text-[10px] text-gray-400 font-mono">Neutral</div>
                     {% else %}
                         <div class="text-[10px] text-gray-600 font-mono">Pending</div>
                     {% endif %}
                {% endif %}
            </div>
            
            <!-- Driver (Optional/Hover) -->
            <div class="absolute inset-0 bg-black/80 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center p-4 backdrop-blur-sm pointer-events-none">
                <div class="text-center">
                    <p class="text-[9px] text-gray-400 uppercase tracking-widest mb-1">Driver</p>
                    <p class="text-xs font-bold text-white">{{ item.keywords or 'Market Sentiment' }}</p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
    {% if offset == 0 %}
    <div class="p-8 text-center text-gray-500 text-sm">No historical signals found.</div>
    {% endif %}
{% endfor %}

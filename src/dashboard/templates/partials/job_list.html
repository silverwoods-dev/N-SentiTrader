<!-- src/dashboard/templates/partials/job_list.html -->
{% for job in jobs %}
<tr
    class="group hover:bg-gray-50/50 dark:hover:bg-gray-900/20 transition-colors border-b border-gray-100 dark:border-gray-800 last:border-none">
    <td class="px-6 py-4 font-mono text-xs text-gray-400">#{{ job.job_id }}</td>
    <td class="px-6 py-4">
        <span
            class="inline-flex items-center px-2 py-1 rounded text-xs font-bold bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-300">
            {{ job.job_type }}
        </span>
    </td>
    <td class="px-6 py-4 font-bold text-gray-900 dark:text-gray-100">{{ job.params.stock_name or job.params.stock_code
        }}</td>
    <td class="px-6 py-4">
        <div class="flex items-center gap-3">
            <div class="flex-1 h-1.5 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden min-w-[80px]">
                <div class="h-full {{ 'bg-indigo-500 animate-pulse' if job.status == 'running' else ('bg-emerald-500' if job.status == 'completed' else 'bg-gray-400') }} transition-all duration-500"
                    style="width: {{ job.progress }}%"></div>
            </div>
            <span
                class="text-[10px] font-bold {{ 'text-indigo-600' if job.status == 'running' else 'text-gray-500' }}">{{
                job.progress }}%</span>
        </div>
    </td>
    <td class="px-6 py-4">
        {% if job.status == 'running' %}
        <span class="flex items-center gap-1.5 text-indigo-600 dark:text-indigo-400 font-bold text-[10px] uppercase">
            <span class="relative flex h-2 w-2">
                <span
                    class="animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2 w-2 bg-indigo-500"></span>
            </span>
            RUNNING
        </span>
        {% elif job.status == 'completed' %}
        <span class="flex items-center gap-1.5 text-emerald-600 dark:text-emerald-400 font-bold text-[10px] uppercase">
            <i data-lucide="check-circle-2" class="w-3 h-3"></i> COMPLETED
        </span>
        {% elif job.status == 'stopped' %}
        <span class="text-amber-500 font-bold text-[10px] uppercase">STOPPED</span>
        {% elif job.status == 'failed' %}
        <span class="flex items-center gap-1.5 text-rose-500 font-bold text-[10px] uppercase">
            <i data-lucide="alert-circle" class="w-3 h-3"></i> FAILED
        </span>
        {% else %}
        <span class="text-gray-500 font-bold text-[10px] uppercase">{{ job.status }}</span>
        {% endif %}
    </td>
    <td class="px-6 py-4 text-[10px] text-gray-400 font-mono">
        {{ job.date_range }}
    </td>
    <td class="px-6 py-4 text-right space-x-1">
        <button onclick="toggleJobDetails('{{ job.job_id }}')"
            class="p-1.5 text-gray-400 hover:text-indigo-500 transition-colors" title="Details">
            <i data-lucide="chevron-down" class="w-4 h-4"></i>
        </button>
        {% if job.status == 'running' %}
        <button onclick="confirmJobAction('{{ job.job_id }}', 'stop', '{{ job.params.stock_name or job.params.stock_code }}')"
            class="p-1.5 text-gray-400 hover:text-amber-500 transition-colors" title="Stop">
            <i data-lucide="square" class="w-4 h-4"></i>
        </button>
        {% endif %}
        {% if job.status in ['failed', 'stopped'] %}
        <button onclick="confirmJobAction('{{ job.job_id }}', 'restart', '{{ job.params.stock_name or job.params.stock_code }}')"
            class="p-1.5 text-gray-400 hover:text-emerald-500 transition-colors" title="Restart">
            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
        </button>
        {% endif %}
        <button onclick="openDeleteModal('{{ job.job_id }}', 'jobs')"
            class="p-1.5 text-gray-400 hover:text-rose-600 transition-colors" title="Delete">
            <i data-lucide="trash-2" class="w-4 h-4"></i>
        </button>
    </td>
</tr>
<!-- Details Row -->
<tr id="job-details-{{ job.job_id }}" class="hidden bg-gray-50/30 dark:bg-gray-900/10">
    <td colspan="7" class="px-6 py-4">
        <div class="grid grid-cols-2 gap-4 text-xs">
            <div>
                <h4 class="font-bold text-gray-700 dark:text-gray-300 mb-2">Job Configuration</h4>
                <div
                    class="space-y-1 text-gray-500 dark:text-gray-400 font-mono bg-white dark:bg-gray-800 p-3 rounded-lg border border-gray-100 dark:border-gray-700">
                    <div class="flex justify-between"><span>Worker:</span> <span
                            class="text-gray-900 dark:text-gray-100">{{ job.worker_id or 'Auto-assign' }}</span></div>
                    <div class="flex justify-between"><span>Prioriy:</span> <span>High</span></div>
                    <div class="flex justify-between"><span>Created:</span> <span>{{ job.created_at | kst }}</span>
                    </div>
                </div>
            </div>
            <div>
                <h4 class="font-bold text-gray-700 dark:text-gray-300 mb-2">Execution Logs</h4>
                <div
                    class="font-mono text-[10px] leading-relaxed text-gray-500 bg-gray-900 text-gray-300 p-3 rounded-lg max-h-24 overflow-y-auto">
                    {% if job.error %}
                    <span class="text-red-400">[ERROR] {{ job.error }}</span><br>
                    {% endif %}
                    {% if job.message %}
                    <span class="text-emerald-400">root@worker:~#</span> <span class="text-gray-300">{{ job.message }}</span>
                    {% else %}
                    <span class="text-gray-500">[INFO] Initializing job...</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </td>
</tr>
{% endfor %}
# N-SentiTrader 시스템 마이그레이션 가이드

본 문서는 Ubuntu Server (N100/x86_64) 환경에서 운영 중인 N-SentiTrader 시스템을 Mac Mini (M4/ARM64) 환경으로 이주하기 위한 절차를 기술합니다.

## 1. 사전 준비 사항

### 1-1. 아키텍처 호환성 확인
- **기존 환경:** Intel/AMD (x86_64)
- **신규 환경:** Apple Silicon (ARM64)
- **주의사항:** CPU 아키텍처가 다르므로 Docker **Image**나 **Volume**을 직접 복사하면 호환성 문제가 발생합니다. 반드시 **소스 코드 기반 재빌드**와 **DB 논리적 백업(SQL)** 방식을 사용해야 합니다.

### 1-2. 필수 파일 확인
이주 대상 폴더(`N-SentiTrader`) 내에 다음 파일이 반드시 포함되어야 합니다.
1. `docker-compose.yml` (설정 파일)
2. `src/` (소스 코드 전체)
3. `n_sentitrader_backup_YYYYMMDD.sql` (DB 백업 파일)

## 2. 이주 절차 (Step-by-Step)

### Step 1: 데이터 백업 (Ubuntu 서버)
현재 Ubuntu 서버에서 데이터베이스 전체를 백업합니다.
*(2025-12-21 기준, 이미 백업 파일 `n_sentitrader_backup_final.sql`이 생성되어 있음)*

만약 최신 데이터로 다시 백업하려면 `N-SentiTrader` 폴더에서 아래 명령어를 실행하세요.
```bash
docker exec n_senti_db pg_dump -U myuser n_senti_db > n_sentitrader_backup_latest.sql
```

### Step 2: 파일 전송
`N-SentiTrader` 폴더 전체를 Mac Mini로 복사합니다. (`scp`, USB, 클라우드 스토리지 등 활용)

### Step 3: Mac Mini에서 시스템 구동
Mac Mini의 터미널에서 프로젝트 폴더로 이동한 후, Docker 컨테이너를 실행합니다.
Apple Silicon 아키텍처에 맞게 이미지를 새로 빌드해야 하므로 `--build` 옵션이 필수입니다.

```bash
# 프로젝트 폴더로 이동
cd N-SentiTrader

# 이미지 재빌드 및 실행 (백그라운드)
docker compose up --build -d
```
> **참고:** 처음 실행 시 DB(`postgres_db`) 컨테이너는 초기화 상태이므로 데이터가 비어 있습니다.

### Step 4: 데이터 복원
새로 실행된 DB 컨테이너에 백업해둔 데이터를 부어넣습니다.

```bash
# 백업 파일을 DB 컨테이너로 스트리밍하여 복원
cat n_sentitrader_backup_final.sql | docker exec -i n_senti_db psql -U myuser n_senti_db
```
> **참고:** 복원 과정에서 `relation "..." already exists` 같은 오류가 발생할 수 있으나, 초기 스키마 생성 스크립트와 중복되어 발생하는 것이므로 무시해도 됩니다.

### Step 5: 정상 작동 확인 (Health Check)
1. **컨테이너 상태 확인:**
   ```bash
   docker ps
   ```
   모든 컨테이너(`dashboard`, `scheduler`, `worker` 등)가 `Up` 상태인지 확인합니다.

2. **대시보드 접속:**
   브라우저를 열고 `http://localhost:8081/analytics/validator` 에 접속합니다.
   * "Performance Trend" 차트에 이전 데이터가 잘 나오는지 확인합니다.
   * "Alpha Correlation" 차트가 뜨는지 확인합니다.

3. **백그라운드 작업 재개:**
   기존에 돌던 백테스팅 작업이 있다면 상태가 `failed`로 남을 수 있습니다. 필요시 대시보드나 스크립트를 통해 작업을 재시작해주세요.

# 요구사항 명세서 (PRD)
**Project:** N-SentiTrader (뉴스 기반 감성사전 및 주가 예측 시스템)
**Version:** 1.1 (Modified)
**Date:** 2025.12.16
**Status:** **Approved for Tech Spec**

---

## 1. 시스템 개요 및 목적
*   **목적:** 금융 뉴스 텍스트 마이닝을 통해 단어별 영향력을 수치화하고, 이를 바탕으로 특정 종목이 익일 시장 대비 초과 수익을 낼지 예측한다.
*   **핵심 가치:** 정교한 **데이터 매칭(시장별 지수)**과 **현실적인 시차 적용(달력일 기준)**을 통해 예측의 신뢰도를 확보한다.
*   **운영 환경:**
    *   **개발(Dev):** `uv`를 활용한 고속 가상환경(`venv`) 관리 및 의존성 해결.
    *   **배포(Prod):** Docker Container 기반의 격리된 실행 환경 및 서비스 오케스트레이션.

---

## 2. 사용자 페르소나
*   **시스템 관리자:** 매일 아침 자동 생성된 리포트의 정합성을 확인하고, 주 1회 학습된 모델의 성능 지표를 모니터링한다.
*   **투자자:** 예측 리포트에서 '매수' 신호가 뜬 종목과 그 근거(키워드)를 참고하여 장 시초가 매매를 수행한다.

---

## 3. 기능 요구사항 (Functional Requirements)

### 3.1 모듈 A: 데이터 수집기 (Collector)

| ID | 요구사항 명 | 상세 설명 | 비고 |
| :--- | :--- | :--- | :--- |
| **FR-A01** | **뉴스 크롤링** | 지정된 포털의 금융 뉴스 섹션에서 종목별 뉴스(제목, 본문, 날짜, 언론사)를 수집한다. | - |
| **FR-A02** | **주가/지수 수집** | 전일자 개별 종목 OHLCV 및 **KOSPI, KOSDAQ 시장 지수**를 각각 수집한다. | - |
| **FR-A03** | **중복 제거** | 제목과 본문의 텍스트 유사도(Cosine Similarity 등)가 90% 이상인 기사는 대표 기사 1건만 저장하고 나머지는 폐기한다. | - |
| **FR-A04** | **데이터 분기 저장** | 수집된 데이터는 `Raw_DB`에 저장하되, 학습용(D-7일 이전)과 추론용(최근 7일) 데이터셋 뷰(View)를 분리한다. | - |
| **FR-A05** | **타겟 라벨링** <br>**(수정됨)** | 초과 수익률($Y$) 계산 시, 종목의 소속 시장에 맞춰 **KOSPI 종목은 KOSPI 지수와, KOSDAQ 종목은 KOSDAQ 지수와 비교**하여 산출한다. | **[개선]** 시장 왜곡 방지 |
| **FR-A06** | **과거 데이터 수집** <br>**(신규)** | 초기 모델 학습을 위해 특정 종목의 과거(최대 6개월 이상) 뉴스를 대량으로 수집하는 유틸리티를 제공한다. **서버 차단 방지(Anti-Blocking)**를 위해 요청 간 랜덤 지연을 적용한다. | **[신규]** Cold Start 해결 |
| **FR-A07** | **IP 우회 및 회전** <br>**(신규)** | 대량 수집 시 IP 차단을 방지하기 위해 **Cloudflare WARP(VPN)**를 활용하여 주기적으로 IP를 변경(Rotation)하며 수집을 수행한다. | **[신규]** 안정적 수집 보장 |

### 3.2 모듈 B: 학습 및 감성사전 구축기 (Learner)

| ID | 요구사항 명 | 상세 설명 | 비고 |
| :--- | :--- | :--- | :--- |
| **FR-B01** | **금융 특화 전처리** <br>**(수정됨)** | Mecab 분석 시, **'사용자 사전(User Dictionary)'**을 우선 적용하여 '2차전지', '밸류업' 등 금융 신조어가 하나의 명사로 인식되도록 한다. | **[개선]** 형태소 분석 오류 최소화 |
| **FR-B02** | **메인 모델 학습** | **[주간]** 과거 3개월 데이터를 로드하여 Lasso 회귀분석을 수행, 통계적으로 유의미한($\beta \neq 0$) 단어만 추출하여 `Main_Dictionary`를 생성한다. | - |
| **FR-B03** | **버퍼 모델 학습** | **[일간]** 최근 3일간 뉴스 중, 빈도수 상위 10% & 변동성 2배 이상인 단어를 추출하여 `Buffer_Dictionary`를 생성한다. | - |
| **FR-B04** | **사전 병합/갱신** | 메인 사전 업데이트 시 이전 버전 점수와 가중 평균(EMA)하여 급격한 변화를 방지한다. | - |
| **FR-B05** | **사전 관리** <br>**(신규)** | 학습 과정에서 사전에 없는 단어(OOV)가 빈번하게 등장할 경우, 이를 별도 로그로 남겨 관리자가 사용자 사전에 추가할 수 있도록 한다. | **[신규]** 유지보수 용이성 |

### 3.3 모듈 C: 예측 및 리포팅 (Predictor)

| ID | 요구사항 명 | 상세 설명 | 비고 |
| :--- | :--- | :--- | :--- |
| **FR-C01** | **점수 산출 (시차)** <br>**(수정됨)** | 과거 뉴스(D-1~D-3) 반영 시, 주식 거래일이 아닌 **'달력일(Calendar Day)' 기준**으로 감쇠 계수를 적용한다. (금요일 뉴스는 월요일에 D-3 가중치 적용) | **[개선]** 주말 효과 반영 |
| **FR-C02** | **앙상블 예측** | $Score_{final} = (w_1 \times Main) + (w_2 \times Buffer)$ 공식에 따라 점수를 산출하고 매수/관망 신호를 생성한다. | - |
| **FR-C03** | **OOV 처리** | 미등록 단어 비율이 전체 본문의 30%를 초과하면 '분석 불가(Unknown)' 상태를 반환한다. | - |
| **FR-C04** | **데일리 리포트** <br>**(수정됨)** | 종목명, 예측 신호, **등락 기여도 상위 단어(Top 10 Keyword)**를 출력한다. 각 키워드별 **관련 뉴스 목록**과 해당 뉴스의 **감성 점수 통계(평균/최대/최소/합계)**를 함께 제공하여 예측 근거를 제시한다. | **[개선]** 설명력 강화 |
| **FR-C05** | **신뢰도 점수** <br>**(신규)** | 예측 결과의 신뢰도를 뉴스 수와 감성 강도를 기반으로 산출하여 함께 표시한다. | **[신규]** 의사결정 지원 |

---

## 4. 데이터 요구사항 (Data Requirements)
*   **DR-01:** 원시 텍스트는 최소 3년, 벡터 데이터는 1년 보관한다.
*   **DR-02:** 종목 마스터 테이블에 `Market_Type` (KOSPI/KOSDAQ) 컬럼을 필수적으로 포함하여 FR-A05 기능을 지원해야 한다. **[수정]**
*   **DR-03:** 사용자 사전 파일(`user_dic.csv`)은 소스 코드와 분리하여 별도 관리하며, 서버 재기동 없이 형태소 분석기에 로드될 수 있어야 한다. **[신규]**

---

## 5. 비기능 요구사항 (Non-Functional Requirements)
*   **NFR-01 (성능):** 전체 프로세스(수집 제외)는 08:30 이전에 완료되어 장 시작 전 리포팅이 가능해야 한다.
*   **NFR-02 (가용성):** 데이터 부족 등으로 모델 학습 실패 시, 자동으로 직전 주차 모델(Previous Version)을 로드하여 중단 없이 서비스를 제공해야 한다.
*   **NFR-03 (확장성):** 추후 ETF나 해외 주식으로 확장 시, 로직 변경 없이 수집 대상 설정만 변경하면 동작해야 한다.

---

# [PRD v1.1 검토 및 분석 결과]

개선된 PRD 내용을 다시 한번 검토(Self-Review)한 결과입니다.

### 1. 개선 사항 반영 확인
*   **✅ 시간 감쇠 기준:** FR-C01에서 **'달력일(Calendar Day)'**을 명시함으로써, 주말 동안 희석되는 정보의 가치를 정확히 반영하도록 정의되었습니다. 이는 월요일 예측의 정확도를 높이는 핵심 요건이 될 것입니다.
*   **✅ 벤치마크 정확성:** FR-A05에서 **시장별(KOSPI/KOSDAQ) 지수 매칭**을 강제하여, 코스닥 잡주가 코스피 지수 하락 때문에 상대적으로 좋아 보이는 착시 현상(Alpha 왜곡)을 차단했습니다.
*   **✅ 신조어 대응:** FR-B01과 FR-B05를 통해 **'사용자 사전'** 프로세스를 추가했습니다. 이는 '2차전지'를 '2차'와 '전지'로 쪼개서 분석하던 기존 Mecab의 한계를 극복하게 해줍니다.

### 2. 기술 사양서 작성 전 최종 점검
*   이 PRD는 개발자가 "무엇을 만들지"에 대한 의문이 없을 정도로 구체화되었습니다.
*   특히 **'달력일 기준 감쇠'**나 **'사용자 사전 적용'**은 구현 난이도가 있는 부분이므로, **기술 사양서(Tech Spec)**에서 구체적인 라이브러리 설정법이나 수식을 상세히 다뤄야 합니다.
# Master Implementation Plan: Hybrid Ordered Lasso & Global Black Swan Engine (마스터 구현 계획서: 하이브리드 순차적 Lasso 및 글로벌 블랙 스완 엔진)

This master plan details the technical transformation of N-SentiTrader into a robust expert system, integrating **Temporal Decay Regularization**, **Information Stability**, and **Global Black Swan Discovery**. (본 마스터 계획서는 N-SentiTrader를 시계열 감쇠 규제, 정보 안정성, 글로벌 블랙 스완 발견 기능이 통합된 견고한 전문가 시스템으로 변환하기 위한 기술적 세부사항을 다룹니다.)

---

## 1. Plan Refinement Process (계획 수립 및 퇴고 과정)

### **Phase A: Core Logic (Lasso & Temporal Decay)**
- **Objective**: Force prioritizion of recent news and eliminate spurious correlations from older lags ($L_5$).
- **Method**: **Ordered Lasso**. Apply exponentially increasing penalty weights to older feature columns.
    - $Weight_{lag} = \gamma^{lag-1}$ (where $\gamma \approx 0.75$).

### **Phase B: Operational Stability (Weekend & Volatility)**
- **Objective 1**: Reflect information aging for Monday morning predictions.
- **Method**: **Continuous Weekend Decay**. $Weight = e^{-0.02 \cdot \Delta hours}$.
- **Objective 2**: Normalize signal strength across market regimes.
- **Method**: **Dynamic 6-State Taxonomy**. Scale thresholds by 30-day volatility.

### **Phase C: Black Swan Discovery (Global Corpus)**
- **Objective**: Identify rare catastrophic terms (War, Embezzlement) that are statistically invisible in single-stock 3-year history ($N=1$).
- **Method**: **Global Corpus Discovery**. Scan the entire KOSPI/KOSDAQ corpus for words coincident with $>3\sigma$ price moves.

---

## 2. Technical Component Refinement (기술 구성 요소 상세)

### **I. [Learner] Ordered Lasso & Temporal Decay (순차적 Lasso 및 시계열 감쇠)**

#### [MODIFY] [lasso.py](file:///Users/dev/CODE/N-SentiTrader/src/learner/lasso.py)
- **Constraint Matrix**: Construct a diagonal weight matrix $W$ where diagonal elements correspond to the lag decay factor.
- **Feature Scaling**: $X'_{text} = X_{text} \cdot W$.
- **Restoration**: Upon model convergence, restore coefficients: $\beta_{real} = \beta_{model} \cdot W$. (This ensures "White Box" dashboard interpretability).

### **II. [Learner] Global Black Swan Discovery (글로벌 블랙 스완 발견)**

#### [NEW] [discovery_engine.py]
- **Scan Logic**: 
    1. Identify all stock-days with $|Return| > 3\sigma$.
    2. Extract n-grams from news on these days (T-1 to T).
    3. Aggregated Frequency Count > Threshold $\rightarrow$ **Critical Words**.
- **Integration**: These words are added to `CRITICAL_WORDS` and bypassed in [LassoLearner](file:///Users/dev/CODE/N-SentiTrader/src/learner/lasso.py#21-635)'s frequency filter ($min\_df=1$).

### **III. [Predictor] Market-Aware Scoring (시장 인지형 스코어링)**

#### [MODIFY] [scoring.py](file:///Users/dev/CODE/N-SentiTrader/src/predictor/scoring.py)
- **Hourly Decay**: In [fetch_news_by_lag](file:///Users/dev/CODE/N-SentiTrader/src/predictor/scoring.py#357-455), calculate time diff from Monday Open (09:00). Apply $e^{-0.02h}$ decay.
- **Dynamic Thresholds**: 
    - Fetch 30-day volatility ($Vol$).
    - $Threshold_{new} = Threshold_{base} \times (Vol / 2\%)$.
- **Black Swan Override**: If `CRITICAL_WORD` detected, force status to **Strong Sell/Buy**.

### **IV. [Learner] Multi-Dimensional AWO (다차원 AWO)**

#### [MODIFY] [awo_engine.py]
- **Current State**: 1D iteration (Months 1-11), fixed $\alpha$.
- **Upgrade Specification**:
    1. **2D Grid Search**:
        - **Outer Loop**: Window Size $W \in [1, 3, 6, 9, 12]$ (Months)
        - **Inner Loop**: Regularization $\alpha \in [1e-5, 5e-5, 1e-4, 5e-4]$
    2. **Metric: Stability Score**:
        - Instead of raw Hit Rate, calculate:
        $$Score(W, \alpha) = \text{Mean(HitRate)}_{NB} - \lambda \cdot \text{Std(HitRate)}_{NB}$$
        - Where $NB$ (Neighbors) are the 3 nearest $(W, \alpha)$ configurations.
        - **Goal**: Find a "Plateau of Performance" rather than a sharp logical peak (overfitting).
    3. **Implementation**:
        - Pass `alpha_list` to [WalkForwardValidator](file:///Users/dev/CODE/N-SentiTrader/src/learner/validator.py#12-309).
        - Validator executes sub-routine for each alpha.

---

## 3. Verification & Validation Roadmap (검증 및 확인 로드맵)

| Phase | Activity | Validation Metric (검증 지표) |
| :--- | :--- | :--- |
| **Logic** | **L5 Ratio Test** | $L_1$ influence sum should be $> 3\times$ $L_5$ influence sum. (L1 영향력 합계가 L5의 3배 이상이어야 함) |
| **Safety** | **Rare Word Rescue Audit** | Verify "Embezzlement" is in Dictionary even if frequency is 1. (빈도가 1이어도 '횡령'이 사전에 있는지 확인) |
| **Ops** | **Monday Decay Check** | Compare Score(Sat 9am) vs Score(Sun 11pm). Sunday should be $\approx 2x$ higher. (일요일 밤 점수가 토요일 아침보다 약 2배 높아야 함) |

---

> [!IMPORTANT]
> **Implementation Integrity (구현 무결성)**
> This plan ensures that every statistical decision (Lasso, Weekend weighting, Volatility scaling) maps to a distinct financial logic. We are building a system that "thinks" like a trader but "learns" like a machine. (이 계획은 모든 통계적 결정이 명확한 금융 논리와 연결되도록 보장합니다. 트레이더처럼 '생각'하되 기계처럼 '학습'하는 시스템을 구축합니다.)

# Analysis Report: N-SentiTrader Dashboard Revamp
# 분석 보고서: N-SentiTrader 대시보드 개편

## 1. Discovery & Current State Analysis
## 1. 현황 분석 및 요구사항 도출

### Current Status
### 프로젝트 현황
- **Validation**: Currently a technical page showing sentiment scores and alpha comparisons for a specific stock.
- **검증(Validation)**: 현재 특정 종목에 대한 감성 점수와 알파 비교를 보여주는 기술 중심 페이지입니다.
- **Expert (Quant Hub)**: Handles deep technical validation (Stability, Calibration, Equity Curves).
- **전문가(Expert)**: 안정성, 캘리브레이션, 수익률 곡선 등 심층적인 기술 검증을 담당합니다.
- **Error Logs**: Basic system events are shown on the main page, but detailed container logs are missing.
- **에러 로그(Error Logs)**: 메인 페이지에 기본적인 시스템 이벤트는 표시되지만, 상세한 컨테이너 로그 기능은 부재합니다.

### User Needs
### 사용자 요구사항
- **Consumer Perspective**: Needs a "Weekly Outlook" - what happened so far this week (Validation) and what's expected for the rest of the week (Prediction).
- **소비자 관점**: '주간 전망(Weekly Outlook)'이 필요합니다. 이번 주 지금까지 어떤 일이 있었는지(검증)와 남은 주간 어떻게 예상되는지(예측)가 핵심입니다.
- **Operation Perspective**: Needs to see *why* a worker failed by viewing internal container logs (`stdout/stderr`) without terminal access.
- **운영 관점**: 터미널 접속 없이도 대시보드에서 `stdout/stderr` 로그를 직접 확인하여 워커의 실패 원인을 즉시 파악할 수 있어야 합니다.

---

## 2. Technical Feasibility Study
## 2. 기술적 타당성 검토

### Weekly Prediction & Validation
### 주간 예측 및 검증
- **Source**: `tb_predictions` (Daily) + `tb_daily_price` (Actuals).
- **데이터 소스**: `tb_predictions` (예측) 및 `tb_daily_price` (실제 가격) 테이블.
- **Logic**: 
- **로직**:
  - **Historical (Mon-Current)**: Join `predictions` with `price` where `date <= today`. Compute Hit Rate for the week.
  - **과거 데이터 (월~현재)**: 가격과 예측 데이터를 조인하여 주간 적중률(Hit Rate)을 계산합니다.
  - **Outlook (Current-Fri)**: Present current model's sentiment distribution and "Expected Alpha" as a weekly trend.
  - **향후 전망 (현재~금)**: 현재 모델의 감성 분포와 '기대 알파'를 주간 트렌드로 시각화합니다.
- **Feasibility**: **High**. Data already exists in the DB.
- **타당성**: **매우 높음**. 필요한 데이터가 이미 DB에 존재합니다.

### Container Log Aggregation
### 컨테이너 로그 수집
- **Mechanism**: Docker Engine API via [/var/run/docker.sock](file:///var/run/docker.sock).
- **메커니즘**: [/var/run/docker.sock](file:///var/run/docker.sock)을 통한 Docker Engine API 활용.
- **Method**: `GET /containers/{id}/logs?stdout=1&stderr=1&tail=200`.
- **방법**: 특정 컨테이너의 표준 출력/에러 로그를 실시간으로 가져옵니다.
- **Security**: Read-only access to logs via socket (already mounted in [dashboard](file:///Users/dev/CODE/N-SentiTrader/tests/test_dashboard_ui.py#8-11) container).
- **보안**: 소켓을 통한 로그 읽기 전용 권한 (대시보드 컨테이너에 이미 마운트됨).
- **Feasibility**: **High**. Core infrastructure is ready.
- **타당성**: **높음**. 핵심 인프라가 이미 준비되어 있습니다.

---

## 3. UI/UX Design Specification
## 3. UI/UX 디자인 명세

### Consumer Dashboard (New "Validation")
### 소비자 대시보드 (새로운 '검증' 페이지)
- **Layout**: Bento-box style with Glassmorphism effects.
- **레이아웃**: 글래스모피즘(Glassmorphism) 효과를 적용한 벤토 박스 스타일.
- **Key Widgets**:
- **주요 위젯**:
  - **Weekly Performance Score**: "This week, AI was 80% correct."
  - **주간 성과 점수**: "이번 주 AI 적중률 80%" 등의 요약 지표.
  - **Price Prediction Overlay**: Candlestick chart with shaded "Expected Range".
  - **가격 예측 오버레이**: 캔들스틱 차트 위에 '예상 변동 범위'를 강조.
  - **Sentiment Pulse**: Word cloud or bubble chart of "Words that moved the market this week".
  - **감성 펄스**: '이번 주 시장을 움직인 핵심 단어'를 워드클라우드나 버블 차트로 표현.

### Centralized Error Monitoring (New "Error Logs")
### 중앙 집중식 에러 모니터링 (새로운 '에러 로그' 페이지)
- **Sidebar**: List of worker containers ([verification](file:///Users/dev/CODE/N-SentiTrader/src/dashboard/data_helpers.py#227-291), `address_1`, `body_1`, etc.).
- **사이드바**: 워커 컨테이너 목록 ([verification](file:///Users/dev/CODE/N-SentiTrader/src/dashboard/data_helpers.py#227-291), `address_1`, `body_1` 등).
- **Live Feed**: ANSI-to-HTML rendered logs for the selected container.
- **실시간 피드**: 선택한 컨테이너의 로그를 ANSI-to-HTML로 렌더링하여 표시.
- **Action Toolbar**: Restart button integrated next to the logs.
- **액션 툴바**: 로그 옆에 해당 컨테이너 재시작 버튼 배치.

---

## 4. Requirement Specification
## 4. 요구사항 명세

- **[REQ-1]**: Transform `/analytics/validator` into a consumer-focused "Weekly Outlook" page.
- **[요구사항-1]**: `/analytics/validator` 페이지를 소비자 중심의 '주간 전망' 페이지로 개편.
- **[REQ-2]**: Implement [src/utils/docker_control.py](file:///Users/dev/CODE/N-SentiTrader/src/utils/docker_control.py) extension to fetch logs.
- **[요구사항-2]**: 로그 추출을 위한 [src/utils/docker_control.py](file:///Users/dev/CODE/N-SentiTrader/src/utils/docker_control.py) 기능 확장.
- **[REQ-3]**: Create `/system/logs/{container_id}` API to stream/fetch container logs.
- **[요구사항-3]**: 컨테이너 로그를 스트리밍/추출하는 `/system/logs/{container_id}` API 생성.
- **[REQ-4]**: Move all "Expert" technical metrics completely to the `Expert` menu.
- **[요구사항-4]**: 기존의 과도한 기술 지표는 모두 `Expert` 메뉴로 완전히 통합 및 이동.

---

## 5. Verification Plan
## 5. 검증 계획

- **Mock Data Test**: Verify weekly aggregation logic with synthetic prediction data.
- **모의 데이터 테스트**: 합성 데이터를 활용하여 주간 집계 로직의 정확성 검증.
- **Socket Connectivity Test**: Confirm dashboard can successfully fetch logs from `n_senti_body_worker_1`.
- **소켓 연결 테스트**: 대시보드 컨테이너가 워커 로그를 성공적으로 가져오는지 확인.
- **UI Responsiveness**: Verify the new Bento widgets scales correctly on mobile (iPhone/iPad).
- **UI 반응성**: 새로운 벤토 위젯이 모바일 기기에서 올바르게 표시되는지 확인.
